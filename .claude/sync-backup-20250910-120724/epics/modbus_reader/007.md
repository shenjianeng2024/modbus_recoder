---
name: 批量数据采集引擎
status: open
created: 2025-09-09T04:10:01Z
updated: 2025-09-09T04:10:01Z
github: [Will be updated when synced to GitHub]
depends_on: [002, 005]
parallel: false
conflicts_with: []
---

# Task: 批量数据采集引擎

## Description

实现长期数据采集功能，支持按设定频率自动采集Modbus数据，后台存储采集结果，提供开始/停止控制和实时状态监控。

## Acceptance Criteria

- [ ] 创建DataCollector组件，提供采集控制界面
- [ ] 实现采集频率配置（毫秒级精度，最小间隔100ms）
- [ ] 实现开始/停止/暂停采集功能，状态持久化
- [ ] 后台异步数据采集，不阻塞界面操作
- [ ] 采集数据内存缓存，支持大量数据的高效存储
- [ ] 实时采集统计显示：成功率、频率、数据量
- [ ] 实现采集过程中的错误处理和自动重试机制

## Technical Details

### 实现方案

1. **组件结构**:
   ```tsx
   // src/components/DataCollector.tsx
   interface CollectionConfig {
     interval: number; // 毫秒
     duration?: number; // 采集时长限制（可选）
     autoReconnect: boolean;
     maxRetries: number;
   }
   
   interface CollectionStats {
     startTime: Date;
     totalSamples: number;
     successfulSamples: number;
     errorCount: number;
     averageInterval: number;
   }
   
   export function DataCollector() {
     // 采集配置、控制和状态显示
   }
   ```

2. **后台采集服务**:
   ```rust
   // src-tauri/src/modbus/collector.rs
   pub struct DataCollector {
       config: CollectionConfig,
       is_running: Arc<AtomicBool>,
       data_buffer: Arc<Mutex<Vec<DataSample>>>,
       stats: Arc<Mutex<CollectionStats>>,
   }
   
   impl DataCollector {
       pub async fn start_collection(&mut self) -> Result<()>;
       pub fn stop_collection(&mut self);
       pub fn get_stats(&self) -> CollectionStats;
       pub fn get_buffer_data(&self) -> Vec<DataSample>;
   }
   ```

3. **Tauri命令接口**:
   ```rust
   #[tauri::command]
   async fn start_data_collection(config: CollectionConfig) -> Result<String, String>
   
   #[tauri::command]
   async fn stop_data_collection() -> Result<String, String>
   
   #[tauri::command]
   async fn get_collection_stats() -> Result<CollectionStats, String>
   ```

4. **界面设计**:
   ```
   ┌─────────────────────────────────────────────────────┐
   │ 数据采集                                             │
   ├─────────────────────────────────────────────────────┤
   │ 采集间隔: [1000] ms  ⚠️最小100ms                    │
   │ 自动重连: ☑️      最大重试: [3] 次                   │
   │                                                     │
   │ [开始采集] [停止采集] [暂停] 状态: 🟢运行中         │
   │                                                     │
   │ ┌─实时统计─────────────────────────────────────────┐ │
   │ │ 运行时间: 00:15:30                              │ │
   │ │ 采集样本: 920 (成功: 915, 失败: 5)              │ │
   │ │ 成功率: 99.5%                                   │ │
   │ │ 实际频率: 998ms (设定: 1000ms)                  │ │
   │ │ 数据缓存: 45.2MB / 100MB                        │ │
   │ └─────────────────────────────────────────────────┘ │
   │                                                     │
   │ 📝 最近错误: 15:29:45 - 连接超时, 自动重试中       │
   └─────────────────────────────────────────────────────┘
   ```

### 核心功能
- **定时采集**: 高精度定时器，确保采集频率稳定
- **缓存管理**: 内存数据缓存，支持大容量数据存储
- **错误恢复**: 网络中断、设备无响应的自动处理
- **统计监控**: 实时性能和质量统计

### 内存优化策略
- 循环缓冲区避免内存无限增长
- 数据分批写入，减少内存压力
- 采集过程与UI更新分离

## Dependencies

- [ ] 任务002（Modbus核心功能）- 后端读取能力
- [ ] 任务005（单次读取功能）- 读取逻辑复用
- [ ] 高精度定时器和异步任务管理

## Effort Estimate

- Size: XL
- Hours: 20-24小时
- Parallel: false（依赖读取功能基础）

## Definition of Done

- [ ] 用户可以设置采集频率并开始长期采集
- [ ] 采集过程在后台稳定运行，不影响界面响应
- [ ] 采集统计信息实时更新，准确反映运行状态
- [ ] 网络中断等异常情况能自动恢复采集
- [ ] 内存使用稳定，长期运行无内存泄漏
- [ ] 采集频率精度满足毫秒级要求
- [ ] 采集数据正确缓存，准备导出处理