---
name: modbus-reader-bug-fixes
status: planning
created: 2025-09-10T04:35:57Z
progress: 0%
prd: .claude/prds/modbus-reader-bug-fixes.md
github: [Will be updated when synced to GitHub]
---

# Epic: Modbus Reader Bug Fixes

## 概述

针对现有Modbus TCP/IP数据采集系统的5个关键bug进行修复，重点解决数据准确性、功能完整性和用户体验问题。通过最小化代码变更的方式，在现有架构基础上进行精准修复，确保系统稳定性和向后兼容性。

**核心目标**: 修复关键功能缺陷，提升数据可靠性，优化用户操作流程  
**技术策略**: 最小侵入式修复，充分利用现有组件和架构

## 架构决策

### 技术选择
- **保持现有技术栈**: Tauri + React + tokio-modbus，无新依赖引入
- **IEEE 754标准**: 严格按照标准实现32位浮点数解析
- **JSON配置格式**: 使用标准JSON格式便于用户理解和编辑
- **现有组件复用**: 最大化利用当前UI组件和状态管理模式

### 设计模式
- **错误边界模式**: 在关键组件周围添加错误处理边界
- **渐进式增强**: 在不破坏现有功能基础上逐步改进
- **配置驱动**: 通过配置文件支持用户自定义显示格式
- **状态一致性**: 确保UI状态与业务逻辑状态同步

## 技术方案

### 后端服务 (Rust/Tauri)
**数据解析层优化**
- 修复`parse_float32`函数中的字节序处理逻辑
- 增强单地址读取的错误处理和验证机制
- 添加浮点数解析的单元测试覆盖

**配置管理增强**
- 扩展现有配置系统支持JSON导出/导入
- 实现地址段配置的序列化/反序列化
- 添加配置文件格式验证

### 前端组件 (React/TypeScript)
**数据显示组件优化**
- 改进`DataDisplay`组件的数值格式化逻辑
- 统一时间戳显示格式，添加本地化支持
- 优化表格数据的视觉展示和排版

**配置管理界面**
- 扩展`AddressRangeManager`组件支持导出/导入功能
- 添加文件选择和配置验证UI
- 实现配置文件的预览和编辑功能

**用户流程引导**
- 改进按钮状态管理和依赖关系逻辑
- 优化连接状态指示和操作引导
- 添加上下文相关的帮助提示

### 基础设施
**测试策略**
- 人工测试为主，关注用户实际使用场景
- 重点测试数据准确性和错误处理路径
- 跨平台兼容性验证

**部署考虑**
- 保持现有构建和部署流程不变
- 确保修复后的版本向后兼容
- 提供详细的发布说明和迁移指南

## 实施策略

### 开发阶段
1. **分析现有问题根因** - 深入调试定位具体问题点
2. **最小化修复** - 仅修改必要的代码，避免大范围重构
3. **逐个验证** - 每个修复完成后立即进行功能验证
4. **回归测试** - 确保修复不影响现有正常功能

### 风险缓解
- **代码审查**: 所有修复代码进行详细审查
- **增量发布**: 按优先级分阶段发布修复
- **快速回滚**: 保持代码版本管理便于问题回滚
- **用户沟通**: 及时向用户说明修复内容和影响

### 测试方法
- **场景化测试**: 模拟真实用户操作场景
- **边界条件测试**: 测试各种异常输入和边界情况
- **兼容性测试**: 验证新旧配置文件的兼容性
- **性能验证**: 确保修复不降低系统性能

## 任务分解预览

基于PRD分析，将创建以下任务类别来覆盖所有实施领域：

- [ ] **任务1: 浮点数解析修复** - 修复32位浮点数解析算法和单地址读取错误
- [ ] **任务2: 地址段配置管理** - 实现JSON格式的导出/导入功能  
- [ ] **任务3: 数据显示格式优化** - 统一数值和时间戳的显示格式
- [ ] **任务4: 用户流程引导改进** - 优化操作逻辑和用户界面引导
- [ ] **任务5: 测试验证和发布** - 全面测试和发布准备

## 依赖关系

### 外部依赖
- **现有代码库**: 基于当前modbus_reader项目的代码基础
- **tokio-modbus库**: 确认库版本支持所需的浮点数操作
- **React/shadcn组件**: 利用现有UI组件库进行界面改进

### 内部依赖
- **现有配置系统**: 扩展而非替换当前配置管理机制
- **数据模型**: 基于现有AddressRange和数据结构进行增强
- **错误处理框架**: 利用现有错误处理模式进行改进

### 时序依赖
- **P0问题优先**: 数据准确性问题必须在功能增强前解决
- **配置兼容性**: 新的JSON配置必须与现有配置共存
- **UI状态同步**: 界面改进必须与后端逻辑修复协调进行

## 成功标准 (技术)

### 性能基准
- **解析性能**: 浮点数解析性能保持或优于当前水平
- **响应时间**: 导出/导入操作响应时间 < 1秒
- **内存使用**: 修复后内存使用无显著增加

### 质量门槛
- **数据准确性**: 32位浮点数解析准确率达到100%
- **错误处理**: 所有异常情况都有适当的错误提示
- **向后兼容**: 现有配置和数据格式完全兼容

### 验收标准
- **功能验证**: 所有PRD中的验收标准都通过测试
- **回归测试**: 现有功能无任何回归问题
- **用户验收**: 内部用户确认修复解决了实际问题

## 预估工作量

### 总体时间线
**3周开发周期** (按PRD优先级执行)

### 资源需求
- **开发工程师**: 1名全栈工程师
- **测试资源**: 内部人工测试
- **评审资源**: 代码审查和用户验收

### 关键路径项目
1. **浮点数解析修复** (Week 1) - 影响数据准确性的核心问题
2. **配置管理功能** (Week 1-2) - 用户工作流程的重要改进
3. **用户体验优化** (Week 2-3) - 提升整体使用体验

### 风险缓冲
- 每个任务预留20%的缓冲时间
- 关键问题如遇技术难点可适当延期
- 保持灵活的发布节奏，确保质量优先