---
last_sync: 2025-09-10T04:07:26Z
name: 单次读取功能实现
status: open
created: 2025-09-09T04:10:01Z
updated: 2025-09-09T11:14:18Z
github: [Will be updated when synced to GitHub]
depends_on: [002, 003, 004]
parallel: false
conflicts_with: []
---

# Task: 单次读取功能实现

## Description

实现单次Modbus数据读取功能，用户可以立即读取配置的地址段数据并在界面上查看结果，不保存到本地存储。支持实时数据显示、错误处理和读取状态指示。

## Acceptance Criteria

- [ ] 创建DataReader组件，显示实时读取的数据
- [ ] 实现"立即读取"按钮，触发所有配置地址段的读取
- [ ] 以表格形式显示读取结果：地址、原始值、解析值、时间戳
- [ ] 支持不同数据类型的解析（uint16, int16, uint32, int32, float32）
- [ ] 添加读取状态指示器（空闲/读取中/完成/错误）
- [ ] 实现读取错误的详细显示和故障诊断信息
- [ ] 支持数据格式切换（十进制/十六进制/二进制）

## Technical Details

### 实现方案

1. **组件结构**:
   ```tsx
   // src/components/DataReader.tsx
   interface ReadResult {
     address: number;
     rawValue: number;
     parsedValue: number | string;
     timestamp: Date;
     success: boolean;
     error?: string;
   }
   
   export function DataReader() {
     const [readResults, setReadResults] = useState<ReadResult[]>([]);
     const [isReading, setIsReading] = useState(false);
     // 读取逻辑和结果显示
   }
   ```

2. **数据解析器**:
   ```tsx
   // src/utils/dataParser.ts
   export const parseModbusData = (
     rawData: number[], 
     dataType: DataType, 
     startAddress: number
   ): ParsedData[] => { ... };
   
   export const formatDisplayValue = (
     value: number, 
     format: 'dec' | 'hex' | 'bin'
   ): string => { ... };
   ```

3. **Tauri命令扩展**:
   ```rust
   // src-tauri/src/commands/reading.rs
   #[tauri::command]
   pub async fn read_modbus_ranges(
       ranges: Vec<AddressRange>
   ) -> Result<Vec<ReadResult>, String> {
       // 批量读取多个地址段
   }
   ```

4. **界面设计**:
   ```
   ┌─────────────────────────────────────────────────────┐
   │ 数据读取                                             │
   ├─────────────────────────────────────────────────────┤
   │ [立即读取] [格式: 十进制▼] 状态: ✅已完成           │
   │                                                     │
   │ ┌─读取结果─────────────────────────────────────────┐ │
   │ │地址  │原始值│解析值 │类型  │时间戳             │ │
   │ ├─────┼─────┼──────┼─────┼──────────────────┤ │
   │ │1000 │12345│123.45│float│2025-09-09 12:34  │ │
   │ │1002 │23456│23456 │uint │2025-09-09 12:34  │ │
   │ │2000 │❌   │错误  │int  │连接超时           │ │
   │ └─────────────────────────────────────────────────┘ │
   │                                                     │
   │ 📊 读取统计: 成功 45/50, 失败 5, 用时 1.2s         │
   └─────────────────────────────────────────────────────┘
   ```

### 核心功能
- **批量读取**: 一次性读取所有配置的地址段
- **实时显示**: 读取结果立即显示，无需刷新
- **错误处理**: 详细的错误信息和恢复建议
- **数据解析**: 根据配置的数据类型正确解析数值

## Dependencies

- [ ] 任务002（Modbus核心功能）- 后端读取接口
- [ ] 任务003（连接配置）- 设备连接状态
- [ ] 任务004（地址范围管理）- 地址段配置数据

## Effort Estimate

- Size: M
- Hours: 12-16小时
- Parallel: false（需要前置任务完成）

## Definition of Done

- [ ] 用户点击"立即读取"能成功获取所有地址段数据
- [ ] 读取结果以清晰的表格形式显示
- [ ] 不同数据类型的解析结果正确显示
- [ ] 读取过程中的状态变化用户可见
- [ ] 连接错误、超时等异常情况有明确提示
- [ ] 读取性能满足要求（<2秒完成常规读取）
- [ ] 数据格式切换功能正常工作