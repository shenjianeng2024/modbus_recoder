---
last_sync: 2025-09-10T04:07:26Z
name: 连接配置界面开发
status: open
created: 2025-09-09T04:10:01Z
updated: 2025-09-09T04:10:01Z
github: [Will be updated when synced to GitHub]
depends_on: [001, 002]
parallel: false
conflicts_with: [004]
---

# Task: 连接配置界面开发

## Description

开发Modbus设备连接配置界面，包括IP地址、端口配置、连接状态显示和连接测试功能。使用shadcn/ui组件创建用户友好的配置界面。

## Acceptance Criteria

- [ ] 创建ConnectionConfig React组件，包含IP和端口输入框
- [ ] 实现IP地址格式验证（IPv4），端口范围验证（1-65535）
- [ ] 添加连接/断开连接按钮，显示当前连接状态
- [ ] 实现连接测试功能，显示连接结果和错误信息
- [ ] 创建useModbusConnection自定义hook管理连接状态
- [ ] 添加连接状态指示器（连接中/已连接/断开连接/错误）
- [ ] 实现表单状态持久化，记住用户上次的配置

## Technical Details

### 实现方案

1. **组件结构**:
   ```tsx
   // src/components/ConnectionConfig.tsx
   interface ConnectionConfigProps {
     onConnectionChange: (connected: boolean) => void;
   }
   
   export function ConnectionConfig({ onConnectionChange }: ConnectionConfigProps) {
     // IP/端口输入、验证、连接管理
   }
   ```

2. **自定义Hook**:
   ```tsx
   // src/hooks/useModbusConnection.ts
   export function useModbusConnection() {
     const [connectionState, setConnectionState] = useState<ConnectionState>('disconnected');
     const [connectionConfig, setConnectionConfig] = useState<ConnectionConfig>();
     
     const connect = async (ip: string, port: number) => { ... };
     const disconnect = async () => { ... };
     const testConnection = async (ip: string, port: number) => { ... };
     
     return { connectionState, connect, disconnect, testConnection };
   }
   ```

3. **shadcn/ui组件使用**:
   - Input: IP地址和端口输入
   - Button: 连接/断开连接/测试连接
   - Card: 配置面板容器
   - Badge: 连接状态指示
   - Alert: 错误和成功消息显示

4. **验证逻辑**:
   ```tsx
   // src/utils/validation.ts
   export const validateIPv4 = (ip: string): boolean => { ... };
   export const validatePort = (port: number): boolean => { ... };
   export const validateConnectionConfig = (config: ConnectionConfig): ValidationResult => { ... };
   ```

### 界面设计
```
┌─────────────────────────────────────┐
│ Modbus连接配置                       │
├─────────────────────────────────────┤
│ IP地址: [192.168.1.100    ] [测试]   │
│ 端口:   [502              ]         │
│                                     │
│ 状态: ●已连接 / ○断开连接 / ⏳连接中   │
│                                     │
│ [连接] [断开连接]                    │
│                                     │
│ ℹ️ 连接成功！设备响应正常              │
└─────────────────────────────────────┘
```

### 核心文件
- `src/components/ConnectionConfig.tsx`: 主配置组件
- `src/hooks/useModbusConnection.ts`: 连接状态管理
- `src/utils/validation.ts`: 输入验证工具
- `src/types/modbus.ts`: 连接相关类型定义

## Dependencies

- [ ] 任务001（项目初始化）- shadcn/ui组件可用
- [ ] 任务002（Modbus核心功能）- 后端连接接口可用
- [ ] 表单验证库（可选：react-hook-form）

## Effort Estimate

- Size: M
- Hours: 12-16小时
- Parallel: false（依赖前端框架和后端接口）

## Definition of Done

- [ ] 用户可以输入有效的IP地址和端口号
- [ ] 输入验证正常工作，无效输入显示错误提示
- [ ] 连接按钮触发后端连接，状态正确显示
- [ ] 连接成功/失败的消息清晰显示给用户
- [ ] 连接状态在整个应用中保持一致
- [ ] 界面响应速度<1秒，用户体验流畅
- [ ] 配置信息能够在会话间保持（localStorage）